---
- name: run the app
  hosts: web
  gather_facts: yes
  become: true
  tasks:
  - name: install curl
    ansible.builtin.apt:
       update_cache: yes
       name: curl
       state: present

  - name: add node source repo
    ansible.builtin.shell: curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -

  - name: install and config node.js
    ansible.builtin.apt:
      name: nodejs
      state: present


  - name: clone the app folder from github to controller node
    ansible.builtin.git:
     repo: "https://github.com/N-AO5/tech264-sparta-app.git"
     dest: /home/ubuntu/repo
     version: main

  - name: Install packages based on package.json.
    community.general.npm:
      path: /home/ubuntu/repo/app/

# Start the application using npm start in the app folder
  - name: Start the application with npm start
      ansible.builtin.shell:
      cmd: npm start
      chdir: /home/ubuntu/repo/app/
